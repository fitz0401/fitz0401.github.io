<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://fitz0401.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://fitz0401.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2023-09-24T09:35:07+00:00</updated><id>https://fitz0401.github.io/feed.xml</id><title type="html">blank</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">ROS和MATLAB实现服务通信</title><link href="https://fitz0401.github.io/blog/2022/ROS-with-Matlab/" rel="alternate" type="text/html" title="ROS和MATLAB实现服务通信"/><published>2022-07-06T13:56:00+00:00</published><updated>2022-07-06T13:56:00+00:00</updated><id>https://fitz0401.github.io/blog/2022/ROS-with-Matlab</id><content type="html" xml:base="https://fitz0401.github.io/blog/2022/ROS-with-Matlab/"><![CDATA[<p>​</p> <ul> <li>硬件条件：两台装有ubuntu的电脑</li> <li>需求：一台工控机向机器人电机端发送指令，一台电脑安装有MATLAB进行实施运动规划。MATLAB和工控机上的ROS节点建立服务通信，采用自定义的数据类型方便数据传输</li> <li>实现方式：ROS中的服务通信，工控机是server端，laptop是client段，服务通信要求client发送数据并从server端接收返回值</li> <li>前置工作：网线直连，IP地址配置</li> </ul> <blockquote> <p>参考链接：</p> <p><a href="https://blog.csdn.net/qq_41253960/article/details/121303505">ROS多机器通信_awhuter的博客</a></p> </blockquote> <h2 id="一自定义服务数据类型的实现">一、自定义服务数据类型的实现</h2> <blockquote> <p>参考链接：</p> <p><a href="https://ww2.mathworks.cn/help/ros/ug/create-custom-messages-from-ros-package.html?searchHighlight=rosgenmsg&amp;s_tid=srchtitle_rosgenmsg_2">Create Custom Messages from ROS Package- MATLAB &amp; Simulink- MathWorks 中国</a></p> <p><a href="https://ww2.mathworks.cn/help/ros/ug/ros-custom-message-support.html#butuk98">ROS Custom Message Support- MATLAB &amp; Simulink- MathWorks 中国</a></p> </blockquote> <p>后者指明了必须先定义好的文件结构（每一个条目都不能少）</p> <p> 其中“custom_robot_msgs”是数据包的名字，本文中制定的数据包名为“lander”。上述文件夹都被放在一个package文件夹内，在该目录下执行：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosgenmsg<span class="o">(</span><span class="s1">'......\package'')
</span></code></pre></div></div> <p>即可在数据包lander的同级目录下生成“matlab_msg_gen_ros1”文件。这行代码没有抱错的话，按照提升继续完成后续操作即可。</p> <p>执行rosmsg list可以查看自定义通信数据结构是否被顺利建立。会生成两个新的数据类型，lander/…Request和lander/…Response</p> <h2 id="二matlab端代码编写">二、MATLAB端代码编写</h2> <p>工控机端采用的语言是C++，编译器是vsCode，其环境配置和服务端实现可供参考的资料较多。</p> <blockquote> <p>参考链接：</p> <p><a href="http://www.autolabor.com.cn/book/ROSTutorials/">Introduction · Autolabor-ROS机器人入门课程《ROS理论与实践》零基础教程</a></p> </blockquote> <p>MATLAB端服务通信可供参考资料较少，主要参考MathWorks Help Center。</p> <p>主要代码如下：</p> <div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">% 初始化ROS网络, 网线通讯已经搭建好，不需要再设置默认端口</span>
<span class="n">rosinit</span> 
<span class="c1">%% 使用'rossvcclient'创建一个客户端，采用我们自定义的数据结构</span>
<span class="c1">% rossvcclient的参数是在服务器（lander）端定义的话题名称</span>
<span class="n">lander_client</span> <span class="o">=</span> <span class="n">rossvcclient</span><span class="p">(</span><span class="s1">'PlanMsg'</span><span class="p">);</span>
<span class="c1">% 检查通讯是否建立</span>
<span class="k">if</span><span class="p">(</span><span class="n">isServerAvailable</span><span class="p">(</span><span class="n">lander_client</span><span class="p">))</span>
    <span class="p">[</span><span class="n">connectionStatus</span><span class="p">,</span><span class="n">connectionStatustext</span><span class="p">]</span> <span class="o">=</span> <span class="n">waitForServer</span><span class="p">(</span><span class="n">lander_client</span><span class="p">)</span>
<span class="k">end</span>
<span class="c1">% 创建服务请求函数</span>
<span class="n">req_msg</span> <span class="o">=</span> <span class="n">rosmessage</span><span class="p">(</span><span class="n">lander_client</span><span class="p">);</span>
<span class="c1">% The default service request message is an empty message of type serviceclient.ServiceType.</span>
<span class="n">req_msg</span><span class="o">.</span><span class="n">CommandIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">% 向工控机发送命令</span>
<span class="n">lander_resp</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">lander_client</span><span class="p">,</span> <span class="n">req_msg</span><span class="p">);</span>
</code></pre></div></div> <p>在matlab端获取ROS全局参数【记得要在参数名前加/】：</p> <div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">% 启动ROS参数服务器</span>
<span class="n">GlobalParam</span> <span class="o">=</span> <span class="n">rosparam</span><span class="p">;</span>
<span class="c1">% 判断上个指令的动作是否执行完毕，并发送数据</span>
    <span class="k">if</span> <span class="nb">count</span> <span class="o">~=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">isFinishFlag</span> <span class="o">==</span> <span class="nb">false</span>
            <span class="n">isFinishFlag</span> <span class="o">=</span> <span class="nb">get</span><span class="p">(</span><span class="n">GlobalParam</span><span class="p">,</span> <span class="s1">'/isFinishFlag'</span><span class="p">);</span>
        <span class="k">end</span>
    <span class="k">end</span>
</code></pre></div></div>]]></content><author><name></name></author><category term="tech"/><category term="ROS"/><summary type="html"><![CDATA[Shown how to use MATLAB to achieve ROS node communication]]></summary></entry><entry><title type="html">Displaying External Posts on Your al-folio Blog</title><link href="https://fitz0401.github.io/blog/2022/displaying-external-posts-on-your-al-folio-blog/" rel="alternate" type="text/html" title="Displaying External Posts on Your al-folio Blog"/><published>2022-04-23T23:20:09+00:00</published><updated>2022-04-23T23:20:09+00:00</updated><id>https://fitz0401.github.io/blog/2022/displaying-external-posts-on-your-al-folio-blog</id><content type="html" xml:base="https://fitz0401.github.io/blog/2022/displaying-external-posts-on-your-al-folio-blog/"><![CDATA[]]></content><author><name></name></author></entry></feed>